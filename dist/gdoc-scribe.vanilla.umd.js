(function(h,u){typeof exports=="object"&&typeof module<"u"?u(exports):typeof define=="function"&&define.amd?define(["exports"],u):(h=typeof globalThis<"u"?globalThis:h||self,u(h.GDocScribeLib={}))})(this,function(h){"use strict";var H=Object.defineProperty;var B=(h,u,y)=>u in h?H(h,u,{enumerable:!0,configurable:!0,writable:!0,value:y}):h[u]=y;var T=(h,u,y)=>B(h,typeof u!="symbol"?u+"":u,y);const u=a=>a.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,""),y=a=>a.map(n=>{var e;return((e=n.textRun)==null?void 0:e.content)||""}).join("").replace(/\u000b/g,"").trim(),S=(a,n=[])=>{const e=[];let t=null,i=null;if(!a)return[];for(let s=0;s<a.length;s++){const o=a[s],c=o.paragraph?y(o.paragraph.elements||[]):"";if(!i&&c.trim().startsWith("```")){const d=c.trim(),r=d.match(/^```(\w*)\s*([\s\S]*?)\s*```$/);if(r&&d.length>3){e.push({type:"code_block",language:r[1]||"",content:r[2]});continue}i={type:"code_block",language:c.trim().replace(/^```/,"").trim(),content:[]};continue}if(i&&c.trim()==="```"){e.push({type:"code_block",language:i.language,content:i.content.join(`
`)}),i=null;continue}if(i){i.content.push(c);continue}if(o.paragraph&&o.paragraph.bullet){const d=o.paragraph.bullet.listId;!t||t.listId!==d?(t={type:"list_group",listId:d||"",items:[o]},e.push(t)):t.items.push(o)}else t=null,e.push(o)}return i&&e.push({type:"code_block",language:i.language,content:i.content.join(`
`)}),n.reduce((s,o)=>o(s),e)},I=a=>{const n=[],e=[];return a.forEach(t=>{var o,c;const i=((c=(o=t.paragraph)==null?void 0:o.bullet)==null?void 0:c.nestingLevel)||0,s={item:t,children:[],level:i};for(;e.length>0&&e[e.length-1].level>=i;)e.pop();e.length===0?n.push(s):e[e.length-1].children.push(s),e.push(s)}),n},_=a=>{const n=[];return a.forEach(e=>{var t,i;if(e.paragraph&&((i=(t=e.paragraph.paragraphStyle)==null?void 0:t.namedStyleType)!=null&&i.startsWith("HEADING"))){const s=e.paragraph.paragraphStyle.namedStyleType,o=parseInt(s.split("_")[1]),c=y(e.paragraph.elements||[]);c&&!isNaN(o)&&n.push({id:u(c),text:c,level:o})}}),n},x=a=>a.split(/(`[^`]+`)/g).map(e=>e.startsWith("`")&&e.endsWith("`")&&e.length>2?{type:"code",content:e.slice(1,-1)}:{type:"text",content:e}).filter(e=>e.content!==""),D=a=>{var e;if(!a)return[];const n=[];return a.bold&&n.push({tag:"strong"}),a.italic&&n.push({tag:"em"}),a.underline&&n.push({tag:"u"}),a.strikethrough&&n.push({tag:"s"}),(e=a.link)!=null&&e.url&&n.push({tag:"a",attrs:{href:a.link.url,target:"_blank",rel:"noopener noreferrer"}}),n},A=a=>{const n=a==null?void 0:a.namedStyleType;if(n==="TITLE")return"h1";if(n==="SUBTITLE")return"p";if(n!=null&&n.startsWith("HEADING_")){const e=n.split("_")[1];if(["1","2","3","4","5","6"].includes(e))return`h${e}`}return"p"},R=(a,n,e)=>{var r,l;if(!a||!e)return{tag:"ul",styleType:"disc"};const t=e[a];if(!t)return{tag:"ul",styleType:"disc"};const i=n||0,s=(l=(r=t.listProperties)==null?void 0:r.nestingLevels)==null?void 0:l[i];let o=s==null?void 0:s.glyphType;if(!o||o==="GLYPH_TYPE_UNSPECIFIED")if(s!=null&&s.glyphSymbol){const p=s.glyphSymbol;p==="●"?o="DISC":p==="○"?o="CIRCLE":p==="■"?o="SQUARE":o="DISC"}else s!=null&&s.glyphFormat&&s.glyphFormat.includes("%")?o="DECIMAL":o="DISC";const d={DECIMAL:{tag:"ol",style:"decimal"},DECIMAL_ZERO:{tag:"ol",style:"decimal-leading-zero"},UPPER_ALPHA:{tag:"ol",style:"upper-alpha"},ALPHA:{tag:"ol",style:"lower-alpha"},UPPER_ROMAN:{tag:"ol",style:"upper-roman"},ROMAN:{tag:"ol",style:"lower-roman"},DISC:{tag:"ul",style:"disc"},CIRCLE:{tag:"ul",style:"circle"},SQUARE:{tag:"ul",style:"square"},NONE:{tag:"ul",style:"none"}}[o]||{tag:"ul",style:"disc"};return{tag:d.tag,styleType:d.style}},k=a=>{switch(a){case"CENTER":return"center";case"END":return"right";case"JUSTIFIED":return"justify";default:return}},w=(a,n)=>{var t,i,s;if(!a||!n)return null;const e=(i=(t=n[a])==null?void 0:t.inlineObjectProperties)==null?void 0:i.embeddedObject;return(s=e==null?void 0:e.imageProperties)!=null&&s.contentUri?{src:e.imageProperties.contentUri,alt:"Embedded Image"}:null},C=a=>a!=null&&a.magnitude&&(a!=null&&a.unit)?`${a.magnitude}${a.unit.toLowerCase()}`:null,j=a=>{if(a!=null&&a.rgbColor){const{red:n,green:e,blue:t}=a.rgbColor,i=Math.round((n||0)*255),s=Math.round((e||0)*255),o=Math.round((t||0)*255);return`rgb(${i}, ${s}, ${o})`}return null};class P{constructor(n,e={}){T(this,"doc");T(this,"inlineObjects");T(this,"options");this.doc=n,this.inlineObjects=n.inlineObjects||null,this.options=e}getToc(){var n;return(n=this.doc.body)!=null&&n.content?_(this.doc.body.content):[]}render(n){var t;if(n.innerHTML="",!((t=this.doc.body)!=null&&t.content))return;S(this.doc.body.content,this.options.transformers).forEach(i=>{var s,o,c,d;try{if("type"in i&&i.type==="list_group"){const r=((s=this.options.renderers)==null?void 0:s.list_group)||this.renderListGroup.bind(this);n.appendChild(r(i.items,this.inlineObjects,this.doc.lists))}else if("type"in i&&i.type==="code_block"){const r=((o=this.options.renderers)==null?void 0:o.code_block)||this.renderCodeBlock.bind(this);n.appendChild(r(i))}else{const r=i;if(r.paragraph){const l=((c=this.options.renderers)==null?void 0:c.paragraph)||this.renderParagraph.bind(this);n.appendChild(l(r.paragraph,this.inlineObjects))}else if(r.table){const l=((d=this.options.renderers)==null?void 0:d.table)||this.renderTable.bind(this);n.appendChild(l(r.table,this.inlineObjects,this.doc.lists))}}}catch(r){console.error("Error rendering block:",r);const l=document.createElement("div");l.style.color="red",l.style.border="1px dashed red",l.style.padding="8px",l.textContent="Error rendering block",n.appendChild(l)}})}renderCodeBlock(n){var i;const e=document.createElement("pre");(i=this.options.classNames)!=null&&i.code_block&&(e.className=this.options.classNames.code_block);const t=document.createElement("code");return n.language&&(t.className=`language-${n.language}`),t.textContent=n.content,e.appendChild(t),e}renderParagraph(n,e){var c,d;const t=n.paragraphStyle,i=A(t),s=document.createElement(i);this.options.classNames&&(this.options.classNames.paragraph&&s.classList.add(this.options.classNames.paragraph),i==="h1"&&this.options.classNames.h1&&s.classList.add(this.options.classNames.h1),i==="h2"&&this.options.classNames.h2&&s.classList.add(this.options.classNames.h2),i==="h3"&&this.options.classNames.h3&&s.classList.add(this.options.classNames.h3),i==="h4"&&this.options.classNames.h4&&s.classList.add(this.options.classNames.h4),i==="h5"&&this.options.classNames.h5&&s.classList.add(this.options.classNames.h5),i==="h6"&&this.options.classNames.h6&&s.classList.add(this.options.classNames.h6));const o=k((t==null?void 0:t.alignment)||void 0);if(o&&(s.style.textAlign=o),t!=null&&t.indentStart){const r=C(t.indentStart);r&&(s.style.paddingLeft=r)}if(t!=null&&t.indentEnd){const r=C(t.indentEnd);r&&(s.style.paddingRight=r)}if(t!=null&&t.indentFirstLine){const r=C(t.indentFirstLine);r&&(s.style.textIndent=r)}if(t!=null&&t.spaceAbove){const r=C(t.spaceAbove);r&&(s.style.marginTop=r)}if(t!=null&&t.spaceBelow){const r=C(t.spaceBelow);r&&(s.style.marginBottom=r)}if((d=(c=t==null?void 0:t.shading)==null?void 0:c.backgroundColor)!=null&&d.color){const r=j(t.shading.backgroundColor.color);r&&(s.style.backgroundColor=r,s.style.padding="10px",s.style.borderRadius="4px")}if(i.startsWith("h")){const r=y(n.elements||[]);r&&(s.id=u(r))}return n.elements&&n.elements.forEach(r=>{var l;if(r.textRun){const p=this.renderTextRun(r.textRun);s.appendChild(p)}else if(r.inlineObjectElement){const g=(((l=this.options.renderers)==null?void 0:l.image)||this.renderImage.bind(this))(r.inlineObjectElement.inlineObjectId,e);g&&s.appendChild(g)}}),s}renderTextRun(n){let e=n.content||"";if(!e)return document.createTextNode("");e=e.replace(/\u000b/g,"");const t=D(n.textStyle),i=c=>{if(t.length===0)return document.createTextNode(c);let d=null,r=null;for(const l of t){const p=document.createElement(l.tag);l.attrs&&Object.entries(l.attrs).forEach(([g,m])=>p.setAttribute(g,m)),d?(r.appendChild(p),r=p):(d=p,r=p)}return r&&(r.textContent=c),d},s=x(e);if(s.length===1&&s[0].type==="text")return i(s[0].content);const o=document.createDocumentFragment();return s.forEach(c=>{if(c.type==="code"){const d=document.createElement("code");if(d.textContent=c.content,t.length===0)o.appendChild(d);else{let r=null,l=null;for(const p of t){const g=document.createElement(p.tag);p.attrs&&Object.entries(p.attrs).forEach(([m,b])=>g.setAttribute(m,b)),r?(l.appendChild(g),l=g):(r=g,l=g)}l?(l.appendChild(d),o.appendChild(r)):o.appendChild(d)}}else o.appendChild(i(c.content))}),o}renderListGroup(n,e,t){const i=I(n);return this.renderListTree(i,e,t)}renderListTree(n,e,t){var l,p,g;if(n.length===0)return document.createElement("ul");const i=n[0],s=(p=(l=i.item.paragraph)==null?void 0:l.bullet)==null?void 0:p.listId,o=i.level,{tag:c,styleType:d}=R(s,o,t||this.doc.lists),r=document.createElement(c);return r.style.listStyleType=d,(g=this.options.classNames)!=null&&g.list_group&&(r.className=this.options.classNames.list_group),n.forEach(m=>{var L,f;const b=document.createElement("li");(L=this.options.classNames)!=null&&L.list_item&&(b.className=this.options.classNames.list_item),(f=m.item.paragraph)!=null&&f.elements&&m.item.paragraph.elements.forEach(N=>{N.textRun&&b.appendChild(this.renderTextRun(N.textRun))}),m.children.length>0&&b.appendChild(this.renderListTree(m.children,e,t)),r.appendChild(b)}),r}renderTable(n,e,t){var o;const i=document.createElement("table");(o=this.options.classNames)!=null&&o.table&&(i.className=this.options.classNames.table);const s=document.createElement("tbody");return i.appendChild(s),(n.tableRows||[]).forEach(c=>{var r;const d=document.createElement("tr");(r=this.options.classNames)!=null&&r.table_row&&(d.className=this.options.classNames.table_row),(c.tableCells||[]).forEach(l=>{var g,m,b;const p=document.createElement("td");(g=this.options.classNames)!=null&&g.table_cell&&(p.className=this.options.classNames.table_cell),(m=l.tableCellStyle)!=null&&m.columnSpan&&(p.colSpan=l.tableCellStyle.columnSpan),(b=l.tableCellStyle)!=null&&b.rowSpan&&(p.rowSpan=l.tableCellStyle.rowSpan),l.content&&S(l.content,this.options.transformers).forEach(f=>{var N,v,O;if("type"in f&&f.type==="list_group"){const E=((N=this.options.renderers)==null?void 0:N.list_group)||this.renderListGroup.bind(this);p.appendChild(E(f.items,e,t))}else if("type"in f&&f.type==="code_block"){const E=((v=this.options.renderers)==null?void 0:v.code_block)||this.renderCodeBlock.bind(this);p.appendChild(E(f))}else{const E=f;if(E.paragraph){const M=((O=this.options.renderers)==null?void 0:O.paragraph)||this.renderParagraph.bind(this);p.appendChild(M(E.paragraph,e))}}}),d.appendChild(p)}),s.appendChild(d)}),i}renderImage(n,e){var s;const t=w(n,e);if(!t)return null;const i=document.createElement("img");return i.src=t.src,i.alt=t.alt,(s=this.options.classNames)!=null&&s.image&&(i.className=this.options.classNames.image),i.style.cursor="pointer",i.onclick=()=>this.openLightbox(i.src),i}openLightbox(n){const e=document.createElement("div");e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.backgroundColor="rgba(0,0,0,0.8)",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.zIndex="9999",e.style.cursor="pointer";const t=document.createElement("img");t.src=n,t.style.maxWidth="90%",t.style.maxHeight="90%",t.style.objectFit="contain",e.appendChild(t),e.onclick=()=>document.body.removeChild(e),document.body.appendChild(e)}}h.GDocScribe=P,h.buildListTree=I,h.extractHeadings=_,h.getAlignmentStyle=k,h.getColorStyle=j,h.getDimensionStyle=C,h.getHeadingTag=A,h.getImageData=w,h.getListTagAndStyle=R,h.getParagraphText=y,h.getTextTags=D,h.parseInlineContent=x,h.processContent=S,h.slugify=u,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});

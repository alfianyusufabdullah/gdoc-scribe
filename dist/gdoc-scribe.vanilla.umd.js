(function(h,y){typeof exports=="object"&&typeof module<"u"?y(exports):typeof define=="function"&&define.amd?define(["exports"],y):(h=typeof globalThis<"u"?globalThis:h||self,y(h.GDocScribeLib={}))})(this,function(h){"use strict";var U=Object.defineProperty;var $=(h,y,C)=>y in h?U(h,y,{enumerable:!0,configurable:!0,writable:!0,value:C}):h[y]=C;var T=(h,y,C)=>$(h,typeof y!="symbol"?y+"":y,C);const y=a=>a.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,""),C=a=>a.map(t=>{var e;return((e=t.textRun)==null?void 0:e.content)||""}).join("").replace(/\u000b/g,"").trim(),S=(a,t=[])=>{const e=[];let s=null,n=null;if(!a)return[];for(let i=0;i<a.length;i++){const r=a[i],o=r.paragraph?C(r.paragraph.elements||[]):"";if(!n&&o.trim().startsWith("```")){const l=o.trim(),c=l.match(/^```(\w*)\s*([\s\S]*?)\s*```$/);if(c&&l.length>3){e.push({type:"code_block",language:c[1]||"",content:c[2]});continue}n={type:"code_block",language:o.trim().replace(/^```/,"").trim(),content:[]};continue}if(n&&o.trim()==="```"){e.push({type:"code_block",language:n.language,content:n.content.join(`
`)}),n=null;continue}if(n){n.content.push(o);continue}if(r.paragraph&&r.paragraph.bullet){const l=r.paragraph.bullet.listId;!s||s.listId!==l?(s={type:"list_group",listId:l||"",items:[r]},e.push(s)):s.items.push(r)}else s=null,e.push(r)}return n&&e.push({type:"code_block",language:n.language,content:n.content.join(`
`)}),t.reduce((i,r)=>r(i),e)},I=a=>{const t=[],e=[];return a.forEach(s=>{var r,o;const n=((o=(r=s.paragraph)==null?void 0:r.bullet)==null?void 0:o.nestingLevel)||0,i={item:s,children:[],level:n};for(;e.length>0&&e[e.length-1].level>=n;)e.pop();e.length===0?t.push(i):e[e.length-1].children.push(i),e.push(i)}),t},_=a=>{const t=[];return a.forEach(e=>{var s,n;if(e.paragraph&&((n=(s=e.paragraph.paragraphStyle)==null?void 0:s.namedStyleType)!=null&&n.startsWith("HEADING"))){const i=e.paragraph.paragraphStyle.namedStyleType,r=parseInt(i.split("_")[1]),o=C(e.paragraph.elements||[]);o&&!isNaN(r)&&t.push({id:y(o),text:o,level:r})}}),t},R=a=>a.split(/(`[^`]+`)/g).map(e=>e.startsWith("`")&&e.endsWith("`")&&e.length>2?{type:"code",content:e.slice(1,-1)}:{type:"text",content:e}).filter(e=>e.content!==""),x=a=>{var e;if(!a)return[];const t=[];return a.bold&&t.push({tag:"strong"}),a.italic&&t.push({tag:"em"}),a.underline&&t.push({tag:"u"}),a.strikethrough&&t.push({tag:"s"}),(e=a.link)!=null&&e.url&&t.push({tag:"a",attrs:{href:a.link.url,target:"_blank",rel:"noopener noreferrer"}}),t},D=a=>{const t=a==null?void 0:a.namedStyleType;if(t==="TITLE")return"h1";if(t==="SUBTITLE")return"p";if(t!=null&&t.startsWith("HEADING_")){const e=t.split("_")[1];if(["1","2","3","4","5","6"].includes(e))return`h${e}`}return"p"},A=(a,t,e)=>{var c,d;if(!a||!e)return{tag:"ul",styleType:"disc"};const s=e[a];if(!s)return{tag:"ul",styleType:"disc"};const n=t||0,i=(d=(c=s.listProperties)==null?void 0:c.nestingLevels)==null?void 0:d[n];let r=i==null?void 0:i.glyphType;if(!r||r==="GLYPH_TYPE_UNSPECIFIED")if(i!=null&&i.glyphSymbol){const p=i.glyphSymbol;p==="●"?r="DISC":p==="○"?r="CIRCLE":p==="■"?r="SQUARE":r="DISC"}else i!=null&&i.glyphFormat&&i.glyphFormat.includes("%")?r="DECIMAL":r="DISC";const l={DECIMAL:{tag:"ol",style:"decimal"},DECIMAL_ZERO:{tag:"ol",style:"decimal-leading-zero"},UPPER_ALPHA:{tag:"ol",style:"upper-alpha"},ALPHA:{tag:"ol",style:"lower-alpha"},UPPER_ROMAN:{tag:"ol",style:"upper-roman"},ROMAN:{tag:"ol",style:"lower-roman"},DISC:{tag:"ul",style:"disc"},CIRCLE:{tag:"ul",style:"circle"},SQUARE:{tag:"ul",style:"square"},NONE:{tag:"ul",style:"none"}}[r]||{tag:"ul",style:"disc"};return{tag:l.tag,styleType:l.style}},w=a=>{switch(a){case"CENTER":return"center";case"END":return"right";case"JUSTIFIED":return"justify";default:return}},P=(a,t)=>{var s,n,i;if(!a||!t)return null;const e=(n=(s=t[a])==null?void 0:s.inlineObjectProperties)==null?void 0:n.embeddedObject;return(i=e==null?void 0:e.imageProperties)!=null&&i.contentUri?{src:e.imageProperties.contentUri,alt:e.title||"Embedded Image",title:e.description||void 0}:null},N=a=>a!=null&&a.magnitude&&(a!=null&&a.unit)?`${a.magnitude}${a.unit.toLowerCase()}`:null,j=a=>{if(a!=null&&a.rgbColor){const{red:t,green:e,blue:s}=a.rgbColor,n=Math.round((t||0)*255),i=Math.round((e||0)*255),r=Math.round((s||0)*255);return`rgb(${n}, ${i}, ${r})`}return null};class F{constructor(t,e={}){T(this,"doc");T(this,"inlineObjects");T(this,"options");this.doc=t,this.inlineObjects=t.inlineObjects||null,this.options=e}getToc(){var t;return(t=this.doc.body)!=null&&t.content?_(this.doc.body.content):[]}render(t){var s;if(t.innerHTML="",!((s=this.doc.body)!=null&&s.content))return;S(this.doc.body.content,this.options.transformers).forEach(n=>{var i,r,o,l,c,d,p,u;try{if("type"in n&&n.type==="list_group"){const g=this.renderListGroupContent(n.items,this.inlineObjects,this.doc.lists),f=((i=this.options.renderers)==null?void 0:i.list_group)||this.defaultRenderListGroup.bind(this);t.appendChild(f({children:g,type:"unordered",className:(r=this.options.classNames)==null?void 0:r.list_group,original:{items:n.items,lists:this.doc.lists}}))}else if("type"in n&&n.type==="code_block"){const g=((o=this.options.renderers)==null?void 0:o.code_block)||this.defaultRenderCodeBlock.bind(this);t.appendChild(g({content:n.content,language:n.language,className:(l=this.options.classNames)==null?void 0:l.code_block,original:{block:n}}))}else{const g=n;if(g.paragraph){const f=this.renderParagraphContent(g.paragraph,this.inlineObjects),m=C(g.paragraph.elements||[]),E=((c=this.options.renderers)==null?void 0:c.paragraph)||this.defaultRenderParagraph.bind(this);t.appendChild(E({children:f,style:g.paragraph.paragraphStyle,text:m,className:(d=this.options.classNames)==null?void 0:d.paragraph,original:{paragraph:g.paragraph}}))}else if(g.table){const f=this.renderTableContent(g.table,this.inlineObjects,this.doc.lists),m=((p=this.options.renderers)==null?void 0:p.table)||this.defaultRenderTable.bind(this);t.appendChild(m({children:f,className:(u=this.options.classNames)==null?void 0:u.table,original:{table:g.table}}))}}}catch(g){console.error("Error rendering block:",g);const f=document.createElement("div");f.style.color="red",f.style.border="1px dashed red",f.style.padding="8px",f.textContent="Error rendering block",t.appendChild(f)}})}defaultRenderCodeBlock(t){const e=document.createElement("pre");t.className&&(e.className=t.className);const s=document.createElement("code");return t.language&&(s.className=`language-${t.language}`),s.textContent=t.content,e.appendChild(s),e}renderParagraphContent(t,e){const s=document.createDocumentFragment();return t.elements&&t.elements.forEach(n=>{var i,r;if(n.textRun){const o=this.renderTextRun(n.textRun);s.appendChild(o)}else if(n.inlineObjectElement){const o=n.inlineObjectElement.inlineObjectId,l=P(o,e);if(l){const d=(((i=this.options.renderers)==null?void 0:i.image)||this.defaultRenderImage.bind(this))({src:l.src,alt:l.alt,title:l.title,className:(r=this.options.classNames)==null?void 0:r.image,original:{objectId:o,inlineObjects:e}});d&&s.appendChild(d)}}}),s}defaultRenderParagraph(t){var r,o;const e=t.style,s=D(e),n=document.createElement(s);t.className&&n.classList.add(t.className),this.options.classNames&&(s==="h1"&&this.options.classNames.h1&&n.classList.add(this.options.classNames.h1),s==="h2"&&this.options.classNames.h2&&n.classList.add(this.options.classNames.h2),s==="h3"&&this.options.classNames.h3&&n.classList.add(this.options.classNames.h3),s==="h4"&&this.options.classNames.h4&&n.classList.add(this.options.classNames.h4),s==="h5"&&this.options.classNames.h5&&n.classList.add(this.options.classNames.h5),s==="h6"&&this.options.classNames.h6&&n.classList.add(this.options.classNames.h6));const i=w((e==null?void 0:e.alignment)||void 0);if(i&&(n.style.textAlign=i),e!=null&&e.indentStart){const l=N(e.indentStart);l&&(n.style.paddingLeft=l)}if(e!=null&&e.indentEnd){const l=N(e.indentEnd);l&&(n.style.paddingRight=l)}if(e!=null&&e.indentFirstLine){const l=N(e.indentFirstLine);l&&(n.style.textIndent=l)}if(e!=null&&e.spaceAbove){const l=N(e.spaceAbove);l&&(n.style.marginTop=l)}if(e!=null&&e.spaceBelow){const l=N(e.spaceBelow);l&&(n.style.marginBottom=l)}if((o=(r=e==null?void 0:e.shading)==null?void 0:r.backgroundColor)!=null&&o.color){const l=j(e.shading.backgroundColor.color);l&&(n.style.backgroundColor=l,n.style.padding="10px",n.style.borderRadius="4px")}return s.startsWith("h")&&t.text&&(n.id=y(t.text)),n.appendChild(t.children),n}renderTextRun(t){let e=t.content||"";if(!e)return document.createTextNode("");e=e.replace(/\u000b/g,"");const s=x(t.textStyle),n=o=>{if(s.length===0)return document.createTextNode(o);let l=null,c=null;for(const d of s){const p=document.createElement(d.tag);d.attrs&&Object.entries(d.attrs).forEach(([u,g])=>p.setAttribute(u,g)),l?(c.appendChild(p),c=p):(l=p,c=p)}return c&&(c.textContent=o),l},i=R(e);if(i.length===1&&i[0].type==="text")return n(i[0].content);const r=document.createDocumentFragment();return i.forEach(o=>{if(o.type==="code"){const l=document.createElement("code");if(l.textContent=o.content,s.length===0)r.appendChild(l);else{let c=null,d=null;for(const p of s){const u=document.createElement(p.tag);p.attrs&&Object.entries(p.attrs).forEach(([g,f])=>u.setAttribute(g,f)),c?(d.appendChild(u),d=u):(c=u,d=u)}d?(d.appendChild(l),r.appendChild(c)):r.appendChild(l)}}else r.appendChild(n(o.content))}),r}renderListGroupContent(t,e,s){const n=I(t);return this.renderListTreeContent(n,e,s)}renderListTreeContent(t,e,s){var c,d;const n=document.createDocumentFragment();if(t.length===0)return n;const i=t[0],r=(d=(c=i.item.paragraph)==null?void 0:c.bullet)==null?void 0:d.listId,o=i.level,{styleType:l}=A(r,o,s||this.doc.lists);return t.forEach(p=>{var g;const u=document.createElement("li");if((g=this.options.classNames)!=null&&g.list_item&&(u.className=this.options.classNames.list_item),u.style.listStyleType=l,p.item.paragraph){const f=this.renderParagraphContent(p.item.paragraph,e);u.appendChild(f)}if(p.children.length>0){const f=this.renderListTreeContent(p.children,e,s),m=document.createElement("ul");m.style.listStyleType="none",m.style.paddingLeft="20px",m.appendChild(f),u.appendChild(m)}n.appendChild(u)}),n}defaultRenderListGroup(t){const e=t.type==="ordered"?"ol":"ul",s=document.createElement(e);return t.className&&(s.className=t.className),s.appendChild(t.children),s}renderTableContent(t,e,s){const n=document.createDocumentFragment(),i=document.createElement("tbody");return n.appendChild(i),(t.tableRows||[]).forEach(r=>{var l;const o=document.createElement("tr");(l=this.options.classNames)!=null&&l.table_row&&(o.className=this.options.classNames.table_row),(r.tableCells||[]).forEach(c=>{var p,u,g;const d=document.createElement("td");(p=this.options.classNames)!=null&&p.table_cell&&(d.className=this.options.classNames.table_cell),(u=c.tableCellStyle)!=null&&u.columnSpan&&(d.colSpan=c.tableCellStyle.columnSpan),(g=c.tableCellStyle)!=null&&g.rowSpan&&(d.rowSpan=c.tableCellStyle.rowSpan),c.content&&S(c.content,this.options.transformers).forEach(m=>{var E,v,k,G,M,O;if("type"in m&&m.type==="list_group"){const b=this.renderListGroupContent(m.items,e,s),L=((E=this.options.renderers)==null?void 0:E.list_group)||this.defaultRenderListGroup.bind(this);d.appendChild(L({children:b,type:"unordered",className:(v=this.options.classNames)==null?void 0:v.list_group,original:{items:m.items,lists:s}}))}else if("type"in m&&m.type==="code_block"){const b=((k=this.options.renderers)==null?void 0:k.code_block)||this.defaultRenderCodeBlock.bind(this);d.appendChild(b({content:m.content,language:m.language,className:(G=this.options.classNames)==null?void 0:G.code_block,original:{block:m}}))}else{const b=m;if(b.paragraph){const L=this.renderParagraphContent(b.paragraph,e),H=C(b.paragraph.elements||[]),B=((M=this.options.renderers)==null?void 0:M.paragraph)||this.defaultRenderParagraph.bind(this);d.appendChild(B({children:L,style:b.paragraph.paragraphStyle,text:H,className:(O=this.options.classNames)==null?void 0:O.paragraph,original:{paragraph:b.paragraph}}))}}}),o.appendChild(d)}),i.appendChild(o)}),n}defaultRenderTable(t){const e=document.createElement("table");return t.className&&(e.className=t.className),e.appendChild(t.children),e}defaultRenderImage(t){const e=document.createElement("img");return e.src=t.src,e.alt=t.alt,t.title&&(e.title=t.title),t.className&&(e.className=t.className),e.style.cursor="pointer",e.onclick=()=>this.openLightbox(e.src),e}openLightbox(t){const e=document.createElement("div");e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.backgroundColor="rgba(0,0,0,0.8)",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.zIndex="9999",e.style.cursor="pointer";const s=document.createElement("img");s.src=t,s.style.maxWidth="90%",s.style.maxHeight="90%",s.style.objectFit="contain",e.appendChild(s),e.onclick=()=>document.body.removeChild(e),document.body.appendChild(e)}}h.GDocScribe=F,h.buildListTree=I,h.extractHeadings=_,h.getAlignmentStyle=w,h.getColorStyle=j,h.getDimensionStyle=N,h.getHeadingTag=D,h.getImageData=P,h.getListTagAndStyle=A,h.getParagraphText=C,h.getTextTags=x,h.parseInlineContent=R,h.processContent=S,h.slugify=y,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});

(function(m,c){typeof exports=="object"&&typeof module<"u"?c(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],c):(m=typeof globalThis<"u"?globalThis:m||self,c(m.GDocScribeLib={},m.React))})(this,function(m,c){"use strict";var re=Object.defineProperty;var ae=(m,c,C)=>c in m?re(m,c,{enumerable:!0,configurable:!0,writable:!0,value:C}):m[c]=C;var w=(m,c,C)=>ae(m,typeof c!="symbol"?c+"":c,C);const C=r=>r.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,""),N=r=>r.map(t=>{var e;return((e=t.textRun)==null?void 0:e.content)||""}).join("").replace(/\u000b/g,"").trim(),_=(r,t=[])=>{const e=[];let a=null,n=null;if(!r)return[];for(let i=0;i<r.length;i++){const l=r[i],p=l.paragraph?N(l.paragraph.elements||[]):"";if(!n&&p.trim().startsWith("```")){const s=p.trim(),o=s.match(/^```(\w*)\s*([\s\S]*?)\s*```$/);if(o&&s.length>3){e.push({type:"code_block",language:o[1]||"",content:o[2]});continue}n={type:"code_block",language:p.trim().replace(/^```/,"").trim(),content:[]};continue}if(n&&p.trim()==="```"){e.push({type:"code_block",language:n.language,content:n.content.join(`
`)}),n=null;continue}if(n){n.content.push(p);continue}if(l.paragraph&&l.paragraph.bullet){const s=l.paragraph.bullet.listId;!a||a.listId!==s?(a={type:"list_group",listId:s||"",items:[l]},e.push(a)):a.items.push(l)}else a=null,e.push(l)}return n&&e.push({type:"code_block",language:n.language,content:n.content.join(`
`)}),t.reduce((i,l)=>l(i),e)},A=r=>{const t=[],e=[];return r.forEach(a=>{var l,p;const n=((p=(l=a.paragraph)==null?void 0:l.bullet)==null?void 0:p.nestingLevel)||0,i={item:a,children:[],level:n};for(;e.length>0&&e[e.length-1].level>=n;)e.pop();e.length===0?t.push(i):e[e.length-1].children.push(i),e.push(i)}),t},F=r=>{const t=[];return r.forEach(e=>{var a,n;if(e.paragraph&&((n=(a=e.paragraph.paragraphStyle)==null?void 0:a.namedStyleType)!=null&&n.startsWith("HEADING"))){const i=e.paragraph.paragraphStyle.namedStyleType,l=parseInt(i.split("_")[1]),p=N(e.paragraph.elements||[]);p&&!isNaN(l)&&t.push({id:C(p),text:p,level:l})}}),t},k=r=>r.split(/(`[^`]+`)/g).map(e=>e.startsWith("`")&&e.endsWith("`")&&e.length>2?{type:"code",content:e.slice(1,-1)}:{type:"text",content:e}).filter(e=>e.content!==""),j=r=>{var e;if(!r)return[];const t=[];return r.bold&&t.push({tag:"strong"}),r.italic&&t.push({tag:"em"}),r.underline&&t.push({tag:"u"}),r.strikethrough&&t.push({tag:"s"}),(e=r.link)!=null&&e.url&&t.push({tag:"a",attrs:{href:r.link.url,target:"_blank",rel:"noopener noreferrer"}}),t},G=r=>{const t=r==null?void 0:r.namedStyleType;if(t==="TITLE")return"h1";if(t==="SUBTITLE")return"p";if(t!=null&&t.startsWith("HEADING_")){const e=t.split("_")[1];if(["1","2","3","4","5","6"].includes(e))return`h${e}`}return"p"},P=(r,t,e)=>{var o,d;if(!r||!e)return{tag:"ul",styleType:"disc"};const a=e[r];if(!a)return{tag:"ul",styleType:"disc"};const n=t||0,i=(d=(o=a.listProperties)==null?void 0:o.nestingLevels)==null?void 0:d[n];let l=i==null?void 0:i.glyphType;if(!l||l==="GLYPH_TYPE_UNSPECIFIED")if(i!=null&&i.glyphSymbol){const u=i.glyphSymbol;u==="●"?l="DISC":u==="○"?l="CIRCLE":u==="■"?l="SQUARE":l="DISC"}else i!=null&&i.glyphFormat&&i.glyphFormat.includes("%")?l="DECIMAL":l="DISC";const s={DECIMAL:{tag:"ol",style:"decimal"},DECIMAL_ZERO:{tag:"ol",style:"decimal-leading-zero"},UPPER_ALPHA:{tag:"ol",style:"upper-alpha"},ALPHA:{tag:"ol",style:"lower-alpha"},UPPER_ROMAN:{tag:"ol",style:"upper-roman"},ROMAN:{tag:"ol",style:"lower-roman"},DISC:{tag:"ul",style:"disc"},CIRCLE:{tag:"ul",style:"circle"},SQUARE:{tag:"ul",style:"square"},NONE:{tag:"ul",style:"none"}}[l]||{tag:"ul",style:"disc"};return{tag:s.tag,styleType:s.style}},B=r=>{switch(r){case"CENTER":return"center";case"END":return"right";case"JUSTIFIED":return"justify";default:return}},v=(r,t)=>{var a,n,i;if(!r||!t)return null;const e=(n=(a=t[r])==null?void 0:a.inlineObjectProperties)==null?void 0:n.embeddedObject;return(i=e==null?void 0:e.imageProperties)!=null&&i.contentUri?{src:e.imageProperties.contentUri,alt:e.title||"Embedded Image",title:e.description||void 0}:null},y=r=>r!=null&&r.magnitude&&(r!=null&&r.unit)?`${r.magnitude}${r.unit.toLowerCase()}`:null,O=r=>{if(r!=null&&r.rgbColor){const{red:t,green:e,blue:a}=r.rgbColor,n=Math.round((t||0)*255),i=Math.round((e||0)*255),l=Math.round((a||0)*255);return`rgb(${n}, ${i}, ${l})`}return null};class z{constructor(t,e={}){w(this,"doc");w(this,"inlineObjects");w(this,"options");this.doc=t,this.inlineObjects=t.inlineObjects||null,this.options=e}getToc(){var t;return(t=this.doc.body)!=null&&t.content?F(this.doc.body.content):[]}render(t){var a;if(t.innerHTML="",!((a=this.doc.body)!=null&&a.content))return;_(this.doc.body.content,this.options.transformers).forEach(n=>{var i,l,p,s,o,d,u,h;try{if("type"in n&&n.type==="list_group"){const g=this.renderListGroupContent(n.items,this.inlineObjects,this.doc.lists),f=((i=this.options.renderers)==null?void 0:i.list_group)||this.defaultRenderListGroup.bind(this);t.appendChild(f({children:g,type:"unordered",className:(l=this.options.classNames)==null?void 0:l.list_group,original:{items:n.items,lists:this.doc.lists}}))}else if("type"in n&&n.type==="code_block"){const g=((p=this.options.renderers)==null?void 0:p.code_block)||this.defaultRenderCodeBlock.bind(this);t.appendChild(g({content:n.content,language:n.language,className:(s=this.options.classNames)==null?void 0:s.code_block,original:{block:n}}))}else{const g=n;if(g.paragraph){const f=this.renderParagraphContent(g.paragraph,this.inlineObjects),b=N(g.paragraph.elements||[]),S=((o=this.options.renderers)==null?void 0:o.paragraph)||this.defaultRenderParagraph.bind(this);t.appendChild(S({children:f,style:g.paragraph.paragraphStyle,text:b,className:(d=this.options.classNames)==null?void 0:d.paragraph,original:{paragraph:g.paragraph}}))}else if(g.table){const f=this.renderTableContent(g.table,this.inlineObjects,this.doc.lists),b=((u=this.options.renderers)==null?void 0:u.table)||this.defaultRenderTable.bind(this);t.appendChild(b({children:f,className:(h=this.options.classNames)==null?void 0:h.table,original:{table:g.table}}))}}}catch(g){console.error("Error rendering block:",g);const f=document.createElement("div");f.style.color="red",f.style.border="1px dashed red",f.style.padding="8px",f.textContent="Error rendering block",t.appendChild(f)}})}defaultRenderCodeBlock(t){const e=document.createElement("pre");t.className&&(e.className=t.className);const a=document.createElement("code");return t.language&&(a.className=`language-${t.language}`),a.textContent=t.content,e.appendChild(a),e}renderParagraphContent(t,e){const a=document.createDocumentFragment();return t.elements&&t.elements.forEach(n=>{var i,l;if(n.textRun){const p=this.renderTextRun(n.textRun);a.appendChild(p)}else if(n.inlineObjectElement){const p=n.inlineObjectElement.inlineObjectId,s=v(p,e);if(s){const d=(((i=this.options.renderers)==null?void 0:i.image)||this.defaultRenderImage.bind(this))({src:s.src,alt:s.alt,title:s.title,className:(l=this.options.classNames)==null?void 0:l.image,original:{objectId:p,inlineObjects:e}});d&&a.appendChild(d)}}}),a}defaultRenderParagraph(t){var l,p;const e=t.style,a=G(e),n=document.createElement(a);t.className&&n.classList.add(t.className),this.options.classNames&&(a==="h1"&&this.options.classNames.h1&&n.classList.add(this.options.classNames.h1),a==="h2"&&this.options.classNames.h2&&n.classList.add(this.options.classNames.h2),a==="h3"&&this.options.classNames.h3&&n.classList.add(this.options.classNames.h3),a==="h4"&&this.options.classNames.h4&&n.classList.add(this.options.classNames.h4),a==="h5"&&this.options.classNames.h5&&n.classList.add(this.options.classNames.h5),a==="h6"&&this.options.classNames.h6&&n.classList.add(this.options.classNames.h6));const i=B((e==null?void 0:e.alignment)||void 0);if(i&&(n.style.textAlign=i),e!=null&&e.indentStart){const s=y(e.indentStart);s&&(n.style.paddingLeft=s)}if(e!=null&&e.indentEnd){const s=y(e.indentEnd);s&&(n.style.paddingRight=s)}if(e!=null&&e.indentFirstLine){const s=y(e.indentFirstLine);s&&(n.style.textIndent=s)}if(e!=null&&e.spaceAbove){const s=y(e.spaceAbove);s&&(n.style.marginTop=s)}if(e!=null&&e.spaceBelow){const s=y(e.spaceBelow);s&&(n.style.marginBottom=s)}if((p=(l=e==null?void 0:e.shading)==null?void 0:l.backgroundColor)!=null&&p.color){const s=O(e.shading.backgroundColor.color);s&&(n.style.backgroundColor=s,n.style.padding="10px",n.style.borderRadius="4px")}return a.startsWith("h")&&t.text&&(n.id=C(t.text)),n.appendChild(t.children),n}renderTextRun(t){let e=t.content||"";if(!e)return document.createTextNode("");e=e.replace(/\u000b/g,"");const a=j(t.textStyle),n=p=>{if(a.length===0)return document.createTextNode(p);let s=null,o=null;for(const d of a){const u=document.createElement(d.tag);d.attrs&&Object.entries(d.attrs).forEach(([h,g])=>u.setAttribute(h,g)),s?(o.appendChild(u),o=u):(s=u,o=u)}return o&&(o.textContent=p),s},i=k(e);if(i.length===1&&i[0].type==="text")return n(i[0].content);const l=document.createDocumentFragment();return i.forEach(p=>{if(p.type==="code"){const s=document.createElement("code");if(s.textContent=p.content,a.length===0)l.appendChild(s);else{let o=null,d=null;for(const u of a){const h=document.createElement(u.tag);u.attrs&&Object.entries(u.attrs).forEach(([g,f])=>h.setAttribute(g,f)),o?(d.appendChild(h),d=h):(o=h,d=h)}d?(d.appendChild(s),l.appendChild(o)):l.appendChild(s)}}else l.appendChild(n(p.content))}),l}renderListGroupContent(t,e,a){const n=A(t);return this.renderListTreeContent(n,e,a)}renderListTreeContent(t,e,a){var o,d;const n=document.createDocumentFragment();if(t.length===0)return n;const i=t[0],l=(d=(o=i.item.paragraph)==null?void 0:o.bullet)==null?void 0:d.listId,p=i.level,{styleType:s}=P(l,p,a||this.doc.lists);return t.forEach(u=>{var g;const h=document.createElement("li");if((g=this.options.classNames)!=null&&g.list_item&&(h.className=this.options.classNames.list_item),h.style.listStyleType=s,u.item.paragraph){const f=this.renderParagraphContent(u.item.paragraph,e);h.appendChild(f)}if(u.children.length>0){const f=this.renderListTreeContent(u.children,e,a),b=document.createElement("ul");b.style.listStyleType="none",b.style.paddingLeft="20px",b.appendChild(f),h.appendChild(b)}n.appendChild(h)}),n}defaultRenderListGroup(t){const e=t.type==="ordered"?"ol":"ul",a=document.createElement(e);return t.className&&(a.className=t.className),a.appendChild(t.children),a}renderTableContent(t,e,a){const n=document.createDocumentFragment(),i=document.createElement("tbody");return n.appendChild(i),(t.tableRows||[]).forEach(l=>{var s;const p=document.createElement("tr");(s=this.options.classNames)!=null&&s.table_row&&(p.className=this.options.classNames.table_row),(l.tableCells||[]).forEach(o=>{var u,h,g;const d=document.createElement("td");(u=this.options.classNames)!=null&&u.table_cell&&(d.className=this.options.classNames.table_cell),(h=o.tableCellStyle)!=null&&h.columnSpan&&(d.colSpan=o.tableCellStyle.columnSpan),(g=o.tableCellStyle)!=null&&g.rowSpan&&(d.rowSpan=o.tableCellStyle.rowSpan),o.content&&_(o.content,this.options.transformers).forEach(b=>{var S,L,T,x,D,I;if("type"in b&&b.type==="list_group"){const E=this.renderListGroupContent(b.items,e,a),$=((S=this.options.renderers)==null?void 0:S.list_group)||this.defaultRenderListGroup.bind(this);d.appendChild($({children:E,type:"unordered",className:(L=this.options.classNames)==null?void 0:L.list_group,original:{items:b.items,lists:a}}))}else if("type"in b&&b.type==="code_block"){const E=((T=this.options.renderers)==null?void 0:T.code_block)||this.defaultRenderCodeBlock.bind(this);d.appendChild(E({content:b.content,language:b.language,className:(x=this.options.classNames)==null?void 0:x.code_block,original:{block:b}}))}else{const E=b;if(E.paragraph){const $=this.renderParagraphContent(E.paragraph,e),te=N(E.paragraph.elements||[]),ne=((D=this.options.renderers)==null?void 0:D.paragraph)||this.defaultRenderParagraph.bind(this);d.appendChild(ne({children:$,style:E.paragraph.paragraphStyle,text:te,className:(I=this.options.classNames)==null?void 0:I.paragraph,original:{paragraph:E.paragraph}}))}}}),p.appendChild(d)}),i.appendChild(p)}),n}defaultRenderTable(t){const e=document.createElement("table");return t.className&&(e.className=t.className),e.appendChild(t.children),e}defaultRenderImage(t){const e=document.createElement("img");return e.src=t.src,e.alt=t.alt,t.title&&(e.title=t.title),t.className&&(e.className=t.className),e.style.cursor="pointer",e.onclick=()=>this.openLightbox(e.src),e}openLightbox(t){const e=document.createElement("div");e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.backgroundColor="rgba(0,0,0,0.8)",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.zIndex="9999",e.style.cursor="pointer";const a=document.createElement("img");a.src=t,a.style.maxWidth="90%",a.style.maxHeight="90%",a.style.objectFit="contain",e.appendChild(a),e.onclick=()=>document.body.removeChild(e),document.body.appendChild(e)}}class q extends c.Component{constructor(t){super(t),this.state={hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0}}componentDidCatch(t,e){console.error("GDocScribe Block Error:",t,e)}render(){return this.state.hasError?this.props.fallback||c.createElement("div",{style:{color:"red",padding:"8px",border:"1px dashed red"}},"Error rendering block"):this.props.children}}function Q({content:r,language:t,className:e}){return c.createElement("pre",{className:e},c.createElement("code",{className:t?`language-${t}`:void 0},r))}function V({paragraph:r,inlineObjects:t,renderers:e,classNames:a}){var i;const n=(e==null?void 0:e.image)||W;return c.createElement(c.Fragment,null,(i=r.elements)==null?void 0:i.map((l,p)=>c.createElement(c.Fragment,{key:p},l.textRun&&c.createElement(H,{textRun:l.textRun}),l.inlineObjectElement&&(()=>{const s=l.inlineObjectElement.inlineObjectId,o=v(s,t);return o?c.createElement(n,{src:o.src,alt:o.alt,title:o.title,className:a==null?void 0:a.image,original:{objectId:s,inlineObjects:t}}):null})())))}function Y({children:r,style:t,text:e,className:a}){var s,o;const n=G(t),i={},l=B((t==null?void 0:t.alignment)||void 0);if(l&&(i.textAlign=l),t!=null&&t.indentStart){const d=y(t.indentStart);d&&(i.paddingLeft=d)}if(t!=null&&t.indentEnd){const d=y(t.indentEnd);d&&(i.paddingRight=d)}if(t!=null&&t.indentFirstLine){const d=y(t.indentFirstLine);d&&(i.textIndent=d)}if(t!=null&&t.spaceAbove){const d=y(t.spaceAbove);d&&(i.marginTop=d)}if(t!=null&&t.spaceBelow){const d=y(t.spaceBelow);d&&(i.marginBottom=d)}if((o=(s=t==null?void 0:t.shading)==null?void 0:s.backgroundColor)!=null&&o.color){const d=O(t.shading.backgroundColor.color);d&&(i.backgroundColor=d,i.padding="10px",i.borderRadius="4px")}let p;return n.startsWith("h")&&e&&(p=C(e)),c.createElement(n,{id:p,style:i,className:a},r)}function H({textRun:r}){if(!r.content)return null;const t=r.content.replace(/\u000b/g,""),e=j(r.textStyle),a=i=>e.length===0?c.createElement(c.Fragment,null,i):e.reduceRight((l,p)=>{const s=p.tag;return c.createElement(s,{...p.attrs},l)},c.createElement(c.Fragment,null,i)),n=k(t);return c.createElement(c.Fragment,null,n.map((i,l)=>i.type==="code"?e.length===0?c.createElement("code",{key:l},i.content):e.reduceRight((p,s)=>{const o=s.tag;return c.createElement(o,{key:l,...s.attrs},p)},c.createElement("code",null,i.content)):c.createElement(c.Fragment,{key:l},a(i.content))))}function J({children:r,type:t,className:e}){const a=t==="ordered"?"ol":"ul";return c.createElement(a,{className:e},r)}function Z({items:r,inlineObjects:t,lists:e,renderers:a,classNames:n}){const i=A(r),l=p=>{var h,g;if(p.length===0)return null;const s=p[0],o=(g=(h=s.item.paragraph)==null?void 0:h.bullet)==null?void 0:g.listId,d=s.level,{styleType:u}=P(o,d,e);return c.createElement(c.Fragment,null,p.map((f,b)=>{var S,L;return c.createElement("li",{key:b,className:n==null?void 0:n.list_item,style:{listStyleType:u}},(L=(S=f.item.paragraph)==null?void 0:S.elements)==null?void 0:L.map((T,x)=>{const D=(a==null?void 0:a.image)||W;return c.createElement(c.Fragment,{key:x},T.textRun&&c.createElement(H,{textRun:T.textRun}),T.inlineObjectElement&&(()=>{const I=T.inlineObjectElement.inlineObjectId,E=v(I,t);return E?c.createElement(D,{src:E.src,alt:E.alt,title:E.title,className:n==null?void 0:n.image,original:{objectId:I,inlineObjects:t}}):null})())}),f.children.length>0&&c.createElement("ul",{style:{listStyleType:"none",paddingLeft:"20px"}},l(f.children)))}))};return l(i)}function K({children:r,className:t}){return c.createElement("table",{className:t},c.createElement("tbody",null,r))}function X({table:r,inlineObjects:t,lists:e,renderContent:a,classNames:n}){var i;return c.createElement(c.Fragment,null,(i=r.tableRows)==null?void 0:i.map((l,p)=>{var s;return c.createElement("tr",{key:p,className:n==null?void 0:n.table_row},(s=l.tableCells)==null?void 0:s.map((o,d)=>{var u,h;return c.createElement("td",{key:d,colSpan:((u=o.tableCellStyle)==null?void 0:u.columnSpan)||void 0,rowSpan:((h=o.tableCellStyle)==null?void 0:h.rowSpan)||void 0,className:n==null?void 0:n.table_cell},o.content&&a(o.content,t,e))}))}))}function W({src:r,alt:t,className:e}){return c.createElement("img",{src:r,alt:t,className:e,style:{maxWidth:"100%",height:"auto",display:"block",margin:"1rem 0"}})}const M=(r,t={})=>{const e=c.useMemo(()=>{var n;return(n=r==null?void 0:r.body)!=null&&n.content?F(r.body.content):[]},[r]);return{html:c.useMemo(()=>{var n;return(n=r==null?void 0:r.body)!=null&&n.content?U(r.body.content,r.inlineObjects,r.lists,t):null},[r,t]),toc:e}};function U(r,t,e,a={}){const{renderers:n={},transformers:i=[],classNames:l={}}=a,p=_(r,i),s=(o,d,u)=>U(o,d,u,a);return p.map((o,d)=>{let u=null,h={};if("type"in o)o.type==="list_group"?(u=n.list_group||J,h={children:c.createElement(Z,{items:o.items,inlineObjects:t,lists:e,renderers:n,classNames:l}),type:"unordered",className:l.list_group,original:{items:o.items,lists:e}}):o.type==="code_block"&&(u=n.code_block||Q,h={content:o.content,language:o.language,className:l.code_block,original:{block:o}});else if(o.paragraph){u=n.paragraph||Y;const g=c.createElement(V,{paragraph:o.paragraph,inlineObjects:t,renderers:n,classNames:l}),f=N(o.paragraph.elements||[]);h={children:g,style:o.paragraph.paragraphStyle,text:f,className:l.paragraph,original:{paragraph:o.paragraph}}}else o.table&&(u=n.table||K,h={children:c.createElement(X,{table:o.table,inlineObjects:t,lists:e,renderContent:s,classNames:l}),className:l.table,original:{table:o.table}});return u?c.createElement(q,{key:d},c.createElement(u,{...h})):null})}const R=({doc:r,className:t,renderers:e,transformers:a})=>{const{html:n,toc:i}=M(r,{renderers:e,transformers:a});return r?c.createElement("div",{className:t},c.createElement("div",{className:"gdoc-content"},n),i.length>0&&c.createElement("nav",{className:"gdoc-toc"},c.createElement("ul",null,i.map(l=>c.createElement("li",{key:l.id,className:`gdoc-toc-level-${l.level}`},c.createElement("a",{href:`#${l.id}`},l.text)))))):null},ee=({doc:r,className:t,renderers:e,transformers:a})=>{const{html:n}=M(r,{renderers:e,transformers:a});return r?c.createElement("div",{className:t},n):null};m.GDocContent=ee,m.GDocScribe=z,m.GDocViewer=R,m.buildListTree=A,m.extractHeadings=F,m.getAlignmentStyle=B,m.getColorStyle=O,m.getDimensionStyle=y,m.getHeadingTag=G,m.getImageData=v,m.getListTagAndStyle=P,m.getParagraphText=N,m.getTextTags=j,m.parseInlineContent=k,m.processContent=_,m.slugify=C,m.useDocs=M,Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});

(function(c,a){typeof exports=="object"&&typeof module<"u"?a(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],a):(c=typeof globalThis<"u"?globalThis:c||self,a(c.GDocScribe={},c.React))})(this,function(c,a){"use strict";var W=Object.defineProperty;var z=(c,a,h)=>a in c?W(c,a,{enumerable:!0,configurable:!0,writable:!0,value:h}):c[a]=h;var x=(c,a,h)=>z(c,typeof a!="symbol"?a+"":a,h);const h=r=>r.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,""),f=r=>r.map(t=>{var e;return((e=t.textRun)==null?void 0:e.content)||""}).join("").replace(/\u000b/g,"").trim(),y=r=>{const t=[];let e=null;return r?(r.forEach(n=>{var s,i;if(n.paragraph&&n.paragraph.bullet){const l=n.paragraph.bullet.listId;e?((i=(s=e.items[0].paragraph)==null?void 0:s.bullet)==null?void 0:i.listId)!==l&&(e={type:"list_group",items:[]},t.push(e)):(e={type:"list_group",items:[]},t.push(e)),e.items.push(n)}else e=null,t.push(n)}),t):[]},b=r=>{const t=[],e=[];return r.forEach(n=>{var l,o;const s=((o=(l=n.paragraph)==null?void 0:l.bullet)==null?void 0:o.nestingLevel)||0,i={item:n,children:[],level:s};for(;e.length>0&&e[e.length-1].level>=s;)e.pop();e.length===0?t.push(i):e[e.length-1].children.push(i),e.push(i)}),t},D=r=>{const t=[];return r.forEach(e=>{var n,s;if(e.paragraph&&((s=(n=e.paragraph.paragraphStyle)==null?void 0:n.namedStyleType)!=null&&s.startsWith("HEADING"))){const i=e.paragraph.paragraphStyle.namedStyleType,l=parseInt(i.split("_")[1]),o=f(e.paragraph.elements||[]);o&&!isNaN(l)&&t.push({id:h(o),text:o,level:l})}}),t},T=r=>{var e;if(!r)return[];const t=[];return r.bold&&t.push({tag:"strong"}),r.italic&&t.push({tag:"em"}),r.underline&&t.push({tag:"u"}),r.strikethrough&&t.push({tag:"s"}),(e=r.link)!=null&&e.url&&t.push({tag:"a",attrs:{href:r.link.url,target:"_blank",rel:"noopener noreferrer"}}),t},C=r=>{const t=r==null?void 0:r.namedStyleType;if(t==="TITLE")return"h1";if(t==="SUBTITLE")return"p";if(t!=null&&t.startsWith("HEADING_")){const e=t.split("_")[1];if(["1","2","3","4","5","6"].includes(e))return`h${e}`}return"p"},S=(r,t,e)=>{var u,g;if(!r||!e)return{tag:"ul",styleType:"disc"};const n=e[r];if(!n)return{tag:"ul",styleType:"disc"};const s=t||0,i=(g=(u=n.listProperties)==null?void 0:u.nestingLevels)==null?void 0:g[s];let l=i==null?void 0:i.glyphType;if(!l||l==="GLYPH_TYPE_UNSPECIFIED")if(i!=null&&i.glyphSymbol){const d=i.glyphSymbol;d==="●"?l="DISC":d==="○"?l="CIRCLE":d==="■"?l="SQUARE":l="DISC"}else i!=null&&i.glyphFormat&&i.glyphFormat.includes("%")?l="DECIMAL":l="DISC";const p={DECIMAL:{tag:"ol",style:"decimal"},DECIMAL_ZERO:{tag:"ol",style:"decimal-leading-zero"},UPPER_ALPHA:{tag:"ol",style:"upper-alpha"},ALPHA:{tag:"ol",style:"lower-alpha"},UPPER_ROMAN:{tag:"ol",style:"upper-roman"},ROMAN:{tag:"ol",style:"lower-roman"},DISC:{tag:"ul",style:"disc"},CIRCLE:{tag:"ul",style:"circle"},SQUARE:{tag:"ul",style:"square"},NONE:{tag:"ul",style:"none"}}[l]||{tag:"ul",style:"disc"};return{tag:p.tag,styleType:p.style}},I=r=>{switch(r){case"CENTER":return"center";case"END":return"right";case"JUSTIFIED":return"justify";default:return}};class P{constructor(t){x(this,"doc");x(this,"inlineObjects");this.doc=t,this.inlineObjects=t.inlineObjects||null}render(t){var n;if(t.innerHTML="",!((n=this.doc.body)!=null&&n.content))return;y(this.doc.body.content).forEach(s=>{if("type"in s&&s.type==="list_group")t.appendChild(this.renderListGroup(s.items));else{const i=s;i.paragraph?t.appendChild(this.renderParagraph(i.paragraph)):i.table&&t.appendChild(this.renderTable(i.table))}})}renderParagraph(t){const e=t.paragraphStyle,n=C(e),s=document.createElement(n),i=I((e==null?void 0:e.alignment)||void 0);if(i&&(s.style.textAlign=i),n.startsWith("h")){const l=f(t.elements||[]);l&&(s.id=h(l))}return t.elements&&t.elements.forEach(l=>{if(l.textRun){const o=this.renderTextRun(l.textRun);s.appendChild(o)}else if(l.inlineObjectElement){const o=this.renderImage(l.inlineObjectElement.inlineObjectId);o&&s.appendChild(o)}}),s}renderTextRun(t){let e=t.content||"";if(!e)return document.createTextNode("");e=e.replace(/\u000b/g,"");const n=T(t.textStyle);if(n.length===0)return document.createTextNode(e);let s=null,i=null;for(const l of n){const o=document.createElement(l.tag);l.attrs&&Object.entries(l.attrs).forEach(([p,u])=>o.setAttribute(p,u)),s?(i.appendChild(o),i=o):(s=o,i=o)}return i&&(i.textContent=e),s}renderListGroup(t){const e=b(t);return this.renderListTree(e)}renderListTree(t){var p,u;if(t.length===0)return document.createElement("ul");const e=t[0],n=(u=(p=e.item.paragraph)==null?void 0:p.bullet)==null?void 0:u.listId,s=e.level,{tag:i,styleType:l}=S(n,s,this.doc.lists),o=document.createElement(i);return o.style.listStyleType=l,t.forEach(g=>{var m;const d=document.createElement("li");(m=g.item.paragraph)!=null&&m.elements&&g.item.paragraph.elements.forEach(E=>{E.textRun&&d.appendChild(this.renderTextRun(E.textRun))}),g.children.length>0&&d.appendChild(this.renderListTree(g.children)),o.appendChild(d)}),o}renderTable(t){const e=document.createElement("table"),n=document.createElement("tbody");return e.appendChild(n),(t.tableRows||[]).forEach(s=>{const i=document.createElement("tr");(s.tableCells||[]).forEach(l=>{var p,u;const o=document.createElement("td");(p=l.tableCellStyle)!=null&&p.columnSpan&&(o.colSpan=l.tableCellStyle.columnSpan),(u=l.tableCellStyle)!=null&&u.rowSpan&&(o.rowSpan=l.tableCellStyle.rowSpan),l.content&&y(l.content).forEach(d=>{if("type"in d&&d.type==="list_group")o.appendChild(this.renderListGroup(d.items));else{const m=d;m.paragraph&&o.appendChild(this.renderParagraph(m.paragraph))}}),i.appendChild(o)}),n.appendChild(i)}),e}renderImage(t){var s,i,l;if(!t||!this.inlineObjects)return null;const e=(i=(s=this.inlineObjects[t])==null?void 0:s.inlineObjectProperties)==null?void 0:i.embeddedObject;if(!((l=e==null?void 0:e.imageProperties)!=null&&l.contentUri))return null;const n=document.createElement("img");return n.src=e.imageProperties.contentUri,n.alt="Embedded Image",n.style.cursor="pointer",n.onclick=()=>this.openLightbox(n.src),n}openLightbox(t){const e=document.createElement("div");e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.backgroundColor="rgba(0,0,0,0.8)",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.zIndex="9999",e.style.cursor="pointer";const n=document.createElement("img");n.src=t,n.style.maxWidth="90%",n.style.maxHeight="90%",n.style.objectFit="contain",e.appendChild(n),e.onclick=()=>document.body.removeChild(e),document.body.appendChild(e)}}const L=r=>{const t=a.useMemo(()=>{var n;return(n=r==null?void 0:r.body)!=null&&n.content?D(r.body.content):[]},[r]);return{html:a.useMemo(()=>{var n;return(n=r==null?void 0:r.body)!=null&&n.content?v(r.body.content,r.inlineObjects,r.lists):null},[r]),toc:t}};function v(r,t,e){return y(r).map((s,i)=>{if("type"in s&&s.type==="list_group")return a.createElement(G,{key:i,items:s.items,inlineObjects:t,lists:e});const l=s;return l.paragraph?a.createElement(w,{key:i,paragraph:l.paragraph,inlineObjects:t}):l.table?a.createElement(_,{key:i,table:l.table,inlineObjects:t,lists:e}):null})}function w({paragraph:r,inlineObjects:t}){var p;const e=r.paragraphStyle,n=C(e),s=n,i=I((e==null?void 0:e.alignment)||void 0),l=i?{textAlign:i}:void 0;let o;if(n.startsWith("h")){const u=f(r.elements||[]);u&&(o=h(u))}return a.createElement(s,{id:o,style:l},(p=r.elements)==null?void 0:p.map((u,g)=>a.createElement(a.Fragment,{key:g},u.textRun&&a.createElement(A,{textRun:u.textRun}),u.inlineObjectElement&&a.createElement(H,{objectId:u.inlineObjectElement.inlineObjectId,inlineObjects:t}))))}function A({textRun:r}){let t=r.content||"";if(!t)return null;t=t.replace(/\u000b/g,"");const e=T(r.textStyle),n=(s,i)=>{if(i.length===0)return s;const[l,...o]=i,p=l.tag;return a.createElement(p,{...l.attrs||{}},n(s,o))};return a.createElement(a.Fragment,null,n(t,e))}function G({items:r,inlineObjects:t,lists:e}){const n=b(r);return a.createElement(N,{nodes:n,inlineObjects:t,lists:e})}function N({nodes:r,inlineObjects:t,lists:e}){var g,d;if(r.length===0)return null;const n=r[0],s=(d=(g=n.item.paragraph)==null?void 0:g.bullet)==null?void 0:d.listId,i=n.level,{tag:l,styleType:o}=S(s,i,e),p=l,u={listStyleType:o};return a.createElement(p,{style:u},r.map((m,E)=>{var j,O;return a.createElement("li",{key:E},(O=(j=m.item.paragraph)==null?void 0:j.elements)==null?void 0:O.map((k,F)=>a.createElement(a.Fragment,{key:F},k.textRun&&a.createElement(A,{textRun:k.textRun}))),m.children.length>0&&a.createElement(N,{nodes:m.children,inlineObjects:t,lists:e}))}))}function _({table:r,inlineObjects:t,lists:e}){var n;return a.createElement("table",null,a.createElement("tbody",null,(n=r.tableRows)==null?void 0:n.map((s,i)=>{var l;return a.createElement("tr",{key:i},(l=s.tableCells)==null?void 0:l.map((o,p)=>{var u,g;return a.createElement("td",{key:p,colSpan:((u=o.tableCellStyle)==null?void 0:u.columnSpan)||1,rowSpan:((g=o.tableCellStyle)==null?void 0:g.rowSpan)||1},o.content&&v(o.content,t,e))}))})))}function H({objectId:r,inlineObjects:t}){var l,o,p;const[e,n]=a.useState(!1);if(!r||!t)return null;const s=(o=(l=t[r])==null?void 0:l.inlineObjectProperties)==null?void 0:o.embeddedObject;if(!((p=s==null?void 0:s.imageProperties)!=null&&p.contentUri))return null;const i=s.imageProperties.contentUri;return a.createElement(a.Fragment,null,a.createElement("img",{src:i,alt:"Embedded",onClick:()=>n(!0),style:{cursor:"pointer"}}),e&&a.createElement("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,cursor:"pointer"},onClick:()=>n(!1)},a.createElement("img",{src:i,style:{maxWidth:"90%",maxHeight:"90%",objectFit:"contain"}})))}const M=({doc:r,className:t})=>{const{html:e,toc:n}=L(r);return r?a.createElement("div",{className:t},a.createElement("div",{className:"gdoc-content"},e),n.length>0&&a.createElement("nav",{className:"gdoc-toc"},a.createElement("ul",null,n.map(s=>a.createElement("li",{key:s.id,className:`gdoc-toc-level-${s.level}`},a.createElement("a",{href:`#${s.id}`},s.text)))))):null},U=({doc:r,className:t})=>{const{html:e}=L(r);return r?a.createElement("div",{className:t},e):null};c.GDocContent=U,c.GDocScribe=P,c.GDocViewer=M,c.buildListTree=b,c.extractHeadings=D,c.getAlignmentStyle=I,c.getHeadingTag=C,c.getListTagAndStyle=S,c.getParagraphText=f,c.getTextTags=T,c.processContent=y,c.slugify=h,c.useDocs=L,Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});

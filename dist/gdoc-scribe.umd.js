(function(g,c){typeof exports=="object"&&typeof module<"u"?c(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],c):(g=typeof globalThis<"u"?globalThis:g||self,c(g.GDocScribe={},g.React))})(this,function(g,c){"use strict";var W=Object.defineProperty;var $=(g,c,f)=>c in g?W(g,c,{enumerable:!0,configurable:!0,writable:!0,value:f}):g[c]=f;var k=(g,c,f)=>$(g,typeof c!="symbol"?c+"":c,f);const f=r=>r.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,""),y=r=>r.map(t=>{var e;return((e=t.textRun)==null?void 0:e.content)||""}).join("").replace(/\u000b/g,"").trim(),E=r=>{var l,s;const t=[];let e=null,n=null;if(!r)return[];for(let i=0;i<r.length;i++){const o=r[i],a=o.paragraph?y(o.paragraph.elements||[]):"";if(!n&&a.trim().startsWith("```")){const u=a.trim(),p=u.match(/^```(\w*)\s*([\s\S]*?)\s*```$/);if(p&&u.length>3){t.push({type:"code_block",language:p[1]||"",content:p[2]});continue}n={type:"code_block",language:a.trim().replace(/^```/,"").trim(),content:[]};continue}if(n&&a.trim()==="```"){t.push({type:"code_block",language:n.language,content:n.content.join(`
`)}),n=null;continue}if(n){n.content.push(a);continue}if(o.paragraph&&o.paragraph.bullet){const u=o.paragraph.bullet.listId;e?((s=(l=e.items[0].paragraph)==null?void 0:l.bullet)==null?void 0:s.listId)!==u&&(e={type:"list_group",items:[]},t.push(e)):(e={type:"list_group",items:[]},t.push(e)),e.items.push(o)}else e=null,t.push(o)}return n&&t.push({type:"code_block",language:n.language,content:n.content.join(`
`)}),t},S=r=>{const t=[],e=[];return r.forEach(n=>{var i,o;const l=((o=(i=n.paragraph)==null?void 0:i.bullet)==null?void 0:o.nestingLevel)||0,s={item:n,children:[],level:l};for(;e.length>0&&e[e.length-1].level>=l;)e.pop();e.length===0?t.push(s):e[e.length-1].children.push(s),e.push(s)}),t},v=r=>{const t=[];return r.forEach(e=>{var n,l;if(e.paragraph&&((l=(n=e.paragraph.paragraphStyle)==null?void 0:n.namedStyleType)!=null&&l.startsWith("HEADING"))){const s=e.paragraph.paragraphStyle.namedStyleType,i=parseInt(s.split("_")[1]),o=y(e.paragraph.elements||[]);o&&!isNaN(i)&&t.push({id:f(o),text:o,level:i})}}),t},T=r=>{var e;if(!r)return[];const t=[];return r.bold&&t.push({tag:"strong"}),r.italic&&t.push({tag:"em"}),r.underline&&t.push({tag:"u"}),r.strikethrough&&t.push({tag:"s"}),(e=r.link)!=null&&e.url&&t.push({tag:"a",attrs:{href:r.link.url,target:"_blank",rel:"noopener noreferrer"}}),t},I=r=>{const t=r==null?void 0:r.namedStyleType;if(t==="TITLE")return"h1";if(t==="SUBTITLE")return"p";if(t!=null&&t.startsWith("HEADING_")){const e=t.split("_")[1];if(["1","2","3","4","5","6"].includes(e))return`h${e}`}return"p"},x=(r,t,e)=>{var u,p;if(!r||!e)return{tag:"ul",styleType:"disc"};const n=e[r];if(!n)return{tag:"ul",styleType:"disc"};const l=t||0,s=(p=(u=n.listProperties)==null?void 0:u.nestingLevels)==null?void 0:p[l];let i=s==null?void 0:s.glyphType;if(!i||i==="GLYPH_TYPE_UNSPECIFIED")if(s!=null&&s.glyphSymbol){const d=s.glyphSymbol;d==="●"?i="DISC":d==="○"?i="CIRCLE":d==="■"?i="SQUARE":i="DISC"}else s!=null&&s.glyphFormat&&s.glyphFormat.includes("%")?i="DECIMAL":i="DISC";const a={DECIMAL:{tag:"ol",style:"decimal"},DECIMAL_ZERO:{tag:"ol",style:"decimal-leading-zero"},UPPER_ALPHA:{tag:"ol",style:"upper-alpha"},ALPHA:{tag:"ol",style:"lower-alpha"},UPPER_ROMAN:{tag:"ol",style:"upper-roman"},ROMAN:{tag:"ol",style:"lower-roman"},DISC:{tag:"ul",style:"disc"},CIRCLE:{tag:"ul",style:"circle"},SQUARE:{tag:"ul",style:"square"},NONE:{tag:"ul",style:"none"}}[i]||{tag:"ul",style:"disc"};return{tag:a.tag,styleType:a.style}},L=r=>{switch(r){case"CENTER":return"center";case"END":return"right";case"JUSTIFIED":return"justify";default:return}};class O{constructor(t){k(this,"doc");k(this,"inlineObjects");this.doc=t,this.inlineObjects=t.inlineObjects||null}render(t){var n;if(t.innerHTML="",!((n=this.doc.body)!=null&&n.content))return;E(this.doc.body.content).forEach(l=>{if("type"in l&&l.type==="list_group")t.appendChild(this.renderListGroup(l.items));else if("type"in l&&l.type==="code_block")t.appendChild(this.renderCodeBlock(l));else{const s=l;s.paragraph?t.appendChild(this.renderParagraph(s.paragraph)):s.table&&t.appendChild(this.renderTable(s.table))}})}renderCodeBlock(t){const e=document.createElement("pre"),n=document.createElement("code");return t.language&&(n.className=`language-${t.language}`),n.textContent=t.content,e.appendChild(n),e}renderParagraph(t){var i,o;const e=t.paragraphStyle,n=I(e),l=document.createElement(n),s=L((e==null?void 0:e.alignment)||void 0);if(s&&(l.style.textAlign=s),e!=null&&e.indentStart){const a=this.getDimensionStyle(e.indentStart);a&&(l.style.paddingLeft=a)}if(e!=null&&e.indentEnd){const a=this.getDimensionStyle(e.indentEnd);a&&(l.style.paddingRight=a)}if(e!=null&&e.indentFirstLine){const a=this.getDimensionStyle(e.indentFirstLine);a&&(l.style.textIndent=a)}if(e!=null&&e.spaceAbove){const a=this.getDimensionStyle(e.spaceAbove);a&&(l.style.marginTop=a)}if(e!=null&&e.spaceBelow){const a=this.getDimensionStyle(e.spaceBelow);a&&(l.style.marginBottom=a)}if((o=(i=e==null?void 0:e.shading)==null?void 0:i.backgroundColor)!=null&&o.color){const a=this.getColorStyle(e.shading.backgroundColor.color);a&&(l.style.backgroundColor=a,l.style.padding="10px",l.style.borderRadius="4px")}if(n.startsWith("h")){const a=y(t.elements||[]);a&&(l.id=f(a))}return t.elements&&t.elements.forEach(a=>{if(a.textRun){const u=this.renderTextRun(a.textRun);l.appendChild(u)}else if(a.inlineObjectElement){const u=this.renderImage(a.inlineObjectElement.inlineObjectId);u&&l.appendChild(u)}}),l}getDimensionStyle(t){return t.magnitude&&t.unit?`${t.magnitude}${t.unit.toLowerCase()}`:null}getColorStyle(t){if(t.rgbColor){const{red:e,green:n,blue:l}=t.rgbColor,s=Math.round((e||0)*255),i=Math.round((n||0)*255),o=Math.round((l||0)*255);return`rgb(${s}, ${i}, ${o})`}return null}renderTextRun(t){let e=t.content||"";if(!e)return document.createTextNode("");e=e.replace(/\u000b/g,"");const n=T(t.textStyle),l=o=>{if(n.length===0)return document.createTextNode(o);let a=null,u=null;for(const p of n){const d=document.createElement(p.tag);p.attrs&&Object.entries(p.attrs).forEach(([h,m])=>d.setAttribute(h,m)),a?(u.appendChild(d),u=d):(a=d,u=d)}return u&&(u.textContent=o),a},s=e.split(/(`[^`]+`)/g);if(s.length===1)return l(e);const i=document.createDocumentFragment();return s.forEach(o=>{if(o.startsWith("`")&&o.endsWith("`")&&o.length>2){const a=o.slice(1,-1),u=document.createElement("code");if(u.textContent=a,n.length===0)i.appendChild(u);else{let p=null,d=null;for(const h of n){const m=document.createElement(h.tag);h.attrs&&Object.entries(h.attrs).forEach(([b,C])=>m.setAttribute(b,C)),p?(d.appendChild(m),d=m):(p=m,d=m)}d?(d.appendChild(u),i.appendChild(p)):i.appendChild(u)}}else o&&i.appendChild(l(o))}),i}renderListGroup(t){const e=S(t);return this.renderListTree(e)}renderListTree(t){var a,u;if(t.length===0)return document.createElement("ul");const e=t[0],n=(u=(a=e.item.paragraph)==null?void 0:a.bullet)==null?void 0:u.listId,l=e.level,{tag:s,styleType:i}=x(n,l,this.doc.lists),o=document.createElement(s);return o.style.listStyleType=i,t.forEach(p=>{var h;const d=document.createElement("li");(h=p.item.paragraph)!=null&&h.elements&&p.item.paragraph.elements.forEach(m=>{m.textRun&&d.appendChild(this.renderTextRun(m.textRun))}),p.children.length>0&&d.appendChild(this.renderListTree(p.children)),o.appendChild(d)}),o}renderTable(t){const e=document.createElement("table"),n=document.createElement("tbody");return e.appendChild(n),(t.tableRows||[]).forEach(l=>{const s=document.createElement("tr");(l.tableCells||[]).forEach(i=>{var a,u;const o=document.createElement("td");(a=i.tableCellStyle)!=null&&a.columnSpan&&(o.colSpan=i.tableCellStyle.columnSpan),(u=i.tableCellStyle)!=null&&u.rowSpan&&(o.rowSpan=i.tableCellStyle.rowSpan),i.content&&E(i.content).forEach(d=>{if("type"in d&&d.type==="list_group")o.appendChild(this.renderListGroup(d.items));else{const h=d;h.paragraph&&o.appendChild(this.renderParagraph(h.paragraph))}}),s.appendChild(o)}),n.appendChild(s)}),e}renderImage(t){var l,s,i;if(!t||!this.inlineObjects)return null;const e=(s=(l=this.inlineObjects[t])==null?void 0:l.inlineObjectProperties)==null?void 0:s.embeddedObject;if(!((i=e==null?void 0:e.imageProperties)!=null&&i.contentUri))return null;const n=document.createElement("img");return n.src=e.imageProperties.contentUri,n.alt="Embedded Image",n.style.cursor="pointer",n.onclick=()=>this.openLightbox(n.src),n}openLightbox(t){const e=document.createElement("div");e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.backgroundColor="rgba(0,0,0,0.8)",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.zIndex="9999",e.style.cursor="pointer";const n=document.createElement("img");n.src=t,n.style.maxWidth="90%",n.style.maxHeight="90%",n.style.objectFit="contain",e.appendChild(n),e.onclick=()=>document.body.removeChild(e),document.body.appendChild(e)}}const D=r=>{const t=c.useMemo(()=>{var n;return(n=r==null?void 0:r.body)!=null&&n.content?v(r.body.content):[]},[r]);return{html:c.useMemo(()=>{var n;return(n=r==null?void 0:r.body)!=null&&n.content?A(r.body.content,r.inlineObjects,r.lists):null},[r]),toc:t}};function A(r,t,e){return E(r).map((l,s)=>{if("type"in l&&l.type==="list_group")return c.createElement(P,{key:s,items:l.items,inlineObjects:t,lists:e});const i=l;return i.paragraph?c.createElement(_,{key:s,paragraph:i.paragraph,inlineObjects:t}):i.table?c.createElement(G,{key:s,table:i.table,inlineObjects:t,lists:e}):null})}function _({paragraph:r,inlineObjects:t}){var a;const e=r.paragraphStyle,n=I(e),l=n,s=L((e==null?void 0:e.alignment)||void 0),i=s?{textAlign:s}:void 0;let o;if(n.startsWith("h")){const u=y(r.elements||[]);u&&(o=f(u))}return c.createElement(l,{id:o,style:i},(a=r.elements)==null?void 0:a.map((u,p)=>c.createElement(c.Fragment,{key:p},u.textRun&&c.createElement(w,{textRun:u.textRun}),u.inlineObjectElement&&c.createElement(M,{objectId:u.inlineObjectElement.inlineObjectId,inlineObjects:t}))))}function w({textRun:r}){let t=r.content||"";if(!t)return null;t=t.replace(/\u000b/g,"");const e=T(r.textStyle),n=(l,s)=>{if(s.length===0)return l;const[i,...o]=s,a=i.tag;return c.createElement(a,{...i.attrs||{}},n(l,o))};return c.createElement(c.Fragment,null,n(t,e))}function P({items:r,inlineObjects:t,lists:e}){const n=S(r);return c.createElement(j,{nodes:n,inlineObjects:t,lists:e})}function j({nodes:r,inlineObjects:t,lists:e}){var p,d;if(r.length===0)return null;const n=r[0],l=(d=(p=n.item.paragraph)==null?void 0:p.bullet)==null?void 0:d.listId,s=n.level,{tag:i,styleType:o}=x(l,s,e),a=i,u={listStyleType:o};return c.createElement(a,{style:u},r.map((h,m)=>{var b,C;return c.createElement("li",{key:m},(C=(b=h.item.paragraph)==null?void 0:b.elements)==null?void 0:C.map((N,U)=>c.createElement(c.Fragment,{key:U},N.textRun&&c.createElement(w,{textRun:N.textRun}))),h.children.length>0&&c.createElement(j,{nodes:h.children,inlineObjects:t,lists:e}))}))}function G({table:r,inlineObjects:t,lists:e}){var n;return c.createElement("table",null,c.createElement("tbody",null,(n=r.tableRows)==null?void 0:n.map((l,s)=>{var i;return c.createElement("tr",{key:s},(i=l.tableCells)==null?void 0:i.map((o,a)=>{var u,p;return c.createElement("td",{key:a,colSpan:((u=o.tableCellStyle)==null?void 0:u.columnSpan)||1,rowSpan:((p=o.tableCellStyle)==null?void 0:p.rowSpan)||1},o.content&&A(o.content,t,e))}))})))}function M({objectId:r,inlineObjects:t}){var i,o,a;const[e,n]=c.useState(!1);if(!r||!t)return null;const l=(o=(i=t[r])==null?void 0:i.inlineObjectProperties)==null?void 0:o.embeddedObject;if(!((a=l==null?void 0:l.imageProperties)!=null&&a.contentUri))return null;const s=l.imageProperties.contentUri;return c.createElement(c.Fragment,null,c.createElement("img",{src:s,alt:"Embedded",onClick:()=>n(!0),style:{cursor:"pointer"}}),e&&c.createElement("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,cursor:"pointer"},onClick:()=>n(!1)},c.createElement("img",{src:s,style:{maxWidth:"90%",maxHeight:"90%",objectFit:"contain"}})))}const F=({doc:r,className:t})=>{const{html:e,toc:n}=D(r);return r?c.createElement("div",{className:t},c.createElement("div",{className:"gdoc-content"},e),n.length>0&&c.createElement("nav",{className:"gdoc-toc"},c.createElement("ul",null,n.map(l=>c.createElement("li",{key:l.id,className:`gdoc-toc-level-${l.level}`},c.createElement("a",{href:`#${l.id}`},l.text)))))):null},H=({doc:r,className:t})=>{const{html:e}=D(r);return r?c.createElement("div",{className:t},e):null};g.GDocContent=H,g.GDocScribe=O,g.GDocViewer=F,g.buildListTree=S,g.extractHeadings=v,g.getAlignmentStyle=L,g.getHeadingTag=I,g.getListTagAndStyle=x,g.getParagraphText=y,g.getTextTags=T,g.processContent=E,g.slugify=f,g.useDocs=D,Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})});
